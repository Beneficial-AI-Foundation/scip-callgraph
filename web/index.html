<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCIP Call Graph Viewer</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <h1>ğŸ“Š SCIP Call Graph Viewer</h1>
      <div class="file-input-container">
        <label for="file-input" class="file-input-label">
          ğŸ“ Load Graph JSON
        </label>
        <input type="file" id="file-input" accept=".json" />
      </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Left Sidebar - Controls -->
      <aside class="sidebar sidebar-left">
        <section class="panel">
          <h2>ğŸ›ï¸ Filters</h2>
          
          <div class="filter-group">
            <h3>Source Type</h3>
            <label class="checkbox-label">
              <input type="checkbox" id="show-libsignal" checked />
              <span class="libsignal-badge">Libsignal</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="show-non-libsignal" checked />
              <span class="other-badge">External</span>
            </label>
          </div>

          <div class="filter-group">
            <h3>ğŸ” Source â†’ Sink</h3>
            <label class="input-label">
              <span>Source (shows callees):</span>
              <input 
                type="text" 
                id="source-input" 
                placeholder="e.g., main, parse_config..." 
                class="search-input"
              />
            </label>
            <label class="input-label">
              <span>Sink (shows callers):</span>
              <input 
                type="text" 
                id="sink-input" 
                placeholder="e.g., to_bytes, validate..." 
                class="search-input"
              />
            </label>
            <small style="color: #666; font-size: 0.75rem; display: block; margin-top: 0.5rem;">
              ğŸ’¡ <strong>Source only:</strong> what it calls (uses depth)<br>
              ğŸ’¡ <strong>Sink only:</strong> who calls it (uses depth)<br>
              ğŸ’¡ <strong>Both:</strong> all paths between them (ignores depth)<br>
              ğŸ’¡ Use <code>"quotes"</code> for exact match
            </small>
          </div>

          <div class="filter-group">
            <h3>Depth Limit</h3>
            <label class="slider-label">
              <span>Max Depth: <strong id="depth-value">1</strong></span>
              <input 
                type="range" 
                id="depth-limit" 
                min="0" 
                max="10" 
                value="1" 
                class="slider"
              />
              <small>0 = Show all nodes (can be slow for large graphs)</small>
            </label>
          </div>

          <div class="button-group">
            <button id="reset-filters" class="btn btn-secondary">
              ğŸ”„ Reset Filters
            </button>
            <button id="clear-selection" class="btn btn-secondary">
              âŒ Clear Selection
            </button>
          </div>

          <div id="hidden-nodes-container" class="filter-group" style="display: none;">
            <h3>ğŸ‘ï¸ Hidden Nodes (<span id="hidden-count">0</span>)</h3>
            <ul id="hidden-nodes-list" class="hidden-nodes-list"></ul>
            <button id="show-all-hidden" class="btn btn-secondary" style="margin-top: 0.5rem;">
              ğŸ‘ï¸ Show All
            </button>
            <small style="color: #666; font-size: 0.75rem; display: block; margin-top: 0.25rem;">
              ğŸ’¡ Shift+click to hide nodes
            </small>
          </div>
        </section>

        <section class="panel">
          <h2>ğŸ“ˆ Statistics</h2>
          <div id="stats" class="stats-container">
            <p>No graph loaded.</p>
            <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">
              ğŸ’¡ You can also load via URL:<br>
              <code style="font-size: 0.75rem;">?json=https://url-to-graph.json</code>
            </p>
          </div>
        </section>
      </aside>

      <!-- Center - Graph Visualization -->
      <main class="graph-section">
        <div id="graph-container" class="graph-container">
          <!-- D3 visualization will be rendered here -->
        </div>
        <div class="graph-instructions">
          <p><strong>ğŸ’¡ Instructions:</strong></p>
          <ul>
            <li><strong>Zoom:</strong> Scroll or pinch</li>
            <li><strong>Pan:</strong> Click and drag background</li>
            <li><strong>Move Node:</strong> Drag a node</li>
            <li><strong>Select:</strong> Click a node to see details</li>
            <li><strong>Hide:</strong> Shift+click a node</li>
            <li><strong>Source/Sink:</strong> Enter function names to explore call paths</li>
          </ul>
        </div>
      </main>

      <!-- Right Sidebar - Node Info -->
      <aside class="sidebar sidebar-right">
        <section class="panel">
          <h2>â„¹ï¸ Node Details</h2>
          <div id="node-info" class="node-info">
            <p class="placeholder">Click or hover over a node to see details</p>
          </div>
        </section>
      </aside>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>
        Built with <a href="https://d3js.org/" target="_blank">D3.js</a> | 
        <a href="https://github.com/Beneficial-AI-Foundation/scip-callgraph" target="_blank">GitHub</a>
      </p>
    </footer>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>

